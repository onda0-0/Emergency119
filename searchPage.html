<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SearchPage</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        /* 최상위 Div */
        .full_size {
            width: 100vw;
            height: 100vh;
        }

        .searchPage {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #1B1C22;
        }

        /* 공통 css */
        .centerItem {
            justify-content: center;
            align-content: center;
        }

        /* 스크롤바 커스텀 */
        *::-webkit-scrollbar {
            width: 10px;
            height: 5px;
        }

        *::-webkit-scrollbar-track {
            background-color: grey;
        }

        *::-webkit-scrollbar-thumb {
            background-color: rgb(24, 24, 24);
        }

        /* 개별 css */
        .spHeader {
            height: 70px;
            background-color: #0F0F10;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        .div_homeIcon {
            width: 200px;
            height: 70%;
            margin-top: auto;
            margin-bottom: auto;
            background-image: url('src/logo/logo10.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
        }

        .div_logo {
            flex-grow: 1;


        }


        .div_profileIcon {
            width: 100px;

        }

        .profileRecommendTop {
            background: linear-gradient(250deg, #5357CE, #C650C0, #F8BB7B);
            height: 20px;
            width: 100%;

        }

        .profileRecommendTitle {

            color: white;
            padding: 20px 10% 10px;
            font-size: 24px;
        }

        .profileRecommend {
            width: 90%;
            height: 320px;
            display: flex;
            flex-direction: row;
            align-self: center;
            overflow-x: auto;
            overflow-y: hidden;


        }

        .profileRecommendContent {
            height: 310px;
            width: 250px;
            padding: 10px;
            margin-left: 15px;
            margin-right: 15px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid gray;
            border-radius: 5px;
        }


        .profileRecommendImg {
            width: 200px;
            height: 200px;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
        }

        .profileRecommendText {
            overflow-y: auto;
            margin-top: 10px;
            height: 100px;
        }

        .profileSearch {
            /* background-color: #6b2a91; */
            display: flex;
            flex-direction: row;

            flex-grow: 1;
            justify-content: space-evenly;
            border: 1px solid gray;
            margin: 20px;
            border-radius: 10px;



            .profileSearchLeft {
                padding-top: 2vh;
                height: 100%;
                width: 45%;
                padding-right: 20px;

                /* background-color: #9c0f95; */


            }

            .profileSearchLine1 {
                background: linear-gradient(to top, #5357CE, #C650C0, #F8BB7B);
                width: 10px;
                height: 90%;
                align-self: center;

                .profileSearchLine2 {
                    width: 100%;
                    height: 100%;
                    align-self: center;
                    background: linear-gradient(to bottom, #5357CE, #C650C0, #F8BB7B);
                    opacity: 1;
                }
            }

            .profileSearchRight {
                padding-top: 2vh;
                height: 100%;
                width: 45%;
                padding-left: 20px;
                /* background-color: #a1054b; */
            }


        }

        .profileSearchFoot {
            height: 100px;
        }

        .profileSearchDatas {
            margin: 5px;
            height: 50px;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr 4fr;
            color: rgb(201, 201, 201);
            border-radius: 5px;
            background-color: #23242A;
            justify-content: space-evenly;
            padding-left: 5px;
        }

        .noGrid {
            display: flex;
            width: 200px;
            height: 40px;
            margin: 0 auto 0 auto;
            background: linear-gradient(20deg, #5357CE, #C650C0, #F8BB7B);
            margin-bottom: 2vh;
        }

        .profileSearchData {
            margin: 5px;
            align-content: center;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
        }

        .profileSearchDataImg {
            height: 100%;
            width: 100%;
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
        }

        .profileSearchFooter {
            position: fixed;
            width: 100%;
            height: 100px;
            bottom: 0;
            background: linear-gradient(to left, #5357CE, #C650C0, #F8BB7B);
            transition: all 1s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;

        }

        .profileSearchFooterGradient {
            position: absolute;
            width: 100%;
            height: 40%;
            background: linear-gradient(to bottom, #1B1C22, #1b1c2200);
            z-index: 3;
        }

        .profileSearchFooterGradient2 {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #5357CE, #d43770, #F8BB7B);
            z-index: 2;
            opacity: 1;
        }

        .div_searchBarOutline {
            width: 70%;
            height: 60px;
            align-content: center;
            margin-top: 30px;
            min-width: 250px;
            border-radius: 10px;
        }

        .div_searchBar {
            min-width: 200px;
            flex: 1 0 auto;
            /* flex-grow: 1; */
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-content: center;


        }

        .searchForm {
            display: flex;
            flex-direction: row;
            width: 80%;
            height: 90%;
        }

        .searchBar {
            position: relative;
            width: 100%;
            height: 40px;
            font-size: 17px;
            padding: 7px 15px 7px 15px;
            background-color: rgb(0, 0, 0);
            border-radius: 10px;
            border: 1px solid #0F0F10;
            color: rgb(255, 255, 255);
            font-weight: 500;
            outline: none;
            opacity: 0.4;
            z-index: 7;
        }

        .searchBarText {
            transition: all 1s ease-in-out;
            position: absolute;
            width: 40%;
            height: 40px;
            z-index: 5;
            background-color: #00000000;
            color: rgb(201, 201, 201);
            border-style: none;
            transform: translateX(-50%);
            left: 50%;
            text-align: center;
            font-size: 22px;
            bottom: 20px;
        }

        .searchBarBtn {
            width: 30px;
            height: 100%;
            z-index: 10;
            background: none;
            border-style: none;
            align-self: center;
        }

        /* index.html 헤더 스타일 s */


        a:hover {
            transform: scale(1.2) translateX(10px);
            transition-duration: 0.5s;
        }

        .navbar {
            height: 60px;
            padding: 0 5px 0 3px;
        }

        .logoimage {
            width: 70px;
            margin-left: 0.7rem;
        }

        .emergencyBtn {
            /* 테두리 지우기 */
            border-style: none;
            /* 모서리 둥글게 깍기 */
            border-radius: 5px;
            /* 글자 색상 */
            color: white;
            /* 버튼 배경색 그라데이션 지정 */
            background: linear-gradient(20deg, #5357ce, #c650c0, #f8bb7b);
        }

        .container-fluid {
            height: 60px;
            padding: 0 20px 0 20px;
        }

        /* index.html 헤더 스타일 e */
    </style>
</head>

<body>
    <div class="full_size">
        <div class="searchPage">
            <!-- 헤더 -->
            <nav class="navbar" style="background-color: #1b1c22">
                <div class="container-fluid">
                    <a class="navbar-brand" href="index.html">
                        <img src="src\logo\logo10.png" class="logoimage" alt="" height="33" />
                    </a>

                    <span id="username" style="color: white"></span>
                    <form class="d-flex">
                        <button type="button" class="emergencyBtn" id="loginbtn">
                            Login
                        </button>
                        <button type="button" class="emergencyBtn" id="logoutbtn" onclick="logout()">
                            Logout
                        </button>
                    </form>
                </div>
            </nav>
            <!-- <div class="spHeader">
                <div class="div_homeIcon">
                </div>
                <div class="div_logo">
                </div>
                <div class="div_profileIcon">
                </div>
            </div> -->
            <div class="profileRecommendTop"></div>
            <div class="profileRecommendTitle">
            </div>
            <div class="profileRecommend">
            </div>
            <div class="profileSearch">
                <div class="profileSearchLeft"></div>
                <div class="profileSearchLine1">
                    <div class="profileSearchLine2"></div>
                </div>
                <div class="profileSearchRight"></div>
            </div>
            <div class="profileSearchFoot"></div>
            <div class="profileSearchFooter">
                <div class="profileSearchFooterGradient2"></div>
                <div class="profileSearchFooterGradient"></div>
                <div class="div_searchBarOutline">
                    <div class="div_searchBar">
                        <form class="centerItem searchForm" action="searchPage.html" method="get"
                            accept-charset="utf-8">
                            <input type="" value="" class="searchBarBtn" />
                            <input class="searchBarText" value="사용자 찾기" readonly />
                            <input type="text" name="searchStr" class="searchBar" />
                            <input type="submit" method="get" value="▷" class="searchBarBtn" />
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- ------------------------스크립트----------------------------- -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script type="module" defer>
        //<<<<<<<<<< DB 정보 >>>>>>>>>>
        //firebaseDB 세팅
        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, deleteDoc, query, limit, collection, addDoc, orderBy, getDocs, getDoc, getCountFromServer } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        // Firebase 구성 정보 설정
        const firebaseConfig = {
            apiKey: "AIzaSyDUo3wGBYmzDE0daVh0twAmzZ2r8TzyrGE",
            authDomain: "watual-f9224.firebaseapp.com",
            projectId: "watual-f9224",
            storageBucket: "watual-f9224.appspot.com",
            messagingSenderId: "307021915043",
            appId: "1:307021915043:web:ec35f5002d695d81a1f016",
            measurementId: "G-248XS4LSEE"
        };
        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        //<<<<<<<<<< DB 정보 >>>>>>>>>>
        //<<<<<<<<<< DB 컬랙션명 : emergency119 >>>>>>>>>>
        let docs = await getDocs(collection(db, `emergency119`));
        let docsCnt = 0;
        let docsCnt2 = 0;
        //<<<<<<<<<< DB 컬랙션명 : emergency119 >>>>>>>>>>

        $('.profileSearchLeft').append(`
                <div class="profileSearchDatas noGrid">
                    <div class="profileSearchData profileSearchDataCnt" style="font-size:17px;font-weight:550;">검색결과 : ${docsCnt}건</div>
                </div>`);
        $('.profileSearchRight').append(`
                <div class="profileSearchDatas noGrid">
                    <div class="profileSearchData profileSearchDataCnt2" style="font-size:17px;font-weight:550;">검색결과 : ${docsCnt2}건</div>
                </div>`);


        // DB 데이터 출력
        let searchStr = getParams("searchStr").searchStr;
        let docsIndex = 0;
        docs.forEach((doc) => {
            // Firebase DB, Table 호출
            let row = doc.data();
            let userid = row['id'];
            let password = row['pw'];
            let name = row['name'];
            let mbti = row['mbti'];
            let introduce = row['introduce'];
            let image = row['image'];
            if(image == undefined){
                console.log(image);
                const mbtiL = mbti.toLowerCase();
                image = `src/mbti/${mbtiL}.png`;
            }
            const goIntroducePage = `sessionStorage.setItem('introduceIndex', JSON.stringify({'introduceIndex' : '${userid}'}));
                location.href = 'introducePage.html';`;

            // console.log(userid + password + name + mbti + introduce + image);
            // 이름 검색
            // console.log(userid.indexOf(searchStr));
            if (userid.indexOf(searchStr) != -1) {

                $('.profileSearchLeft').append(`
                <div class="profileSearchDatas" onclick="${goIntroducePage}">
                    <div class="profileSearchDataImg" style="background-image:url('${image}')"></div>
                    <div class="profileSearchData">${userid} 님</div>
                    <div class="profileSearchData">${name}</div>
                    <div class="profileSearchData">${mbti}</div>
                    <div class="profileSearchData">${introduce}</div>
                </div>`);

                docsCnt++;
                $('.profileSearchDataCnt').text(`검색결과 : ${docsCnt}건`);
            }
            // 전체 검색
            if (userid.includes(searchStr) || name.includes(searchStr) || mbti.includes(searchStr) || introduce.includes(searchStr)) {
                $('.profileSearchRight').append(`
                <div class="profileSearchDatas" onclick="${goIntroducePage}">
                    <div class="profileSearchDataImg" style="background-image:url('${image}')"></div>
                    <div class="profileSearchData">${userid} 님</div>
                    <div class="profileSearchData">${name}</div>
                    <div class="profileSearchData">${mbti}</div>
                    <div class="profileSearchData">${introduce}</div>
                </div>`);
                docsCnt2++;
                $('.profileSearchDataCnt2').text(`검색결과 : ${docsCnt2}건`);
            }
            // 추천 프로필
            let randomColor = "#" + (parseInt(Math.random() * 0xffffff)).toString(16);
            $('.profileRecommend').append(`
                <div class="profileRecommendContent" style="border-color: ${randomColor};" onclick="${goIntroducePage}">
                    <div class="profileRecommendImg" style="background-image:url('${image}')"></div>
                    <div class="profileRecommendText">
                        ${mbti} ${userid}</br>
                        <div style="color:gray;">
                            ${introduce}
                        </div>
                    </div>
                </div>`);
        });


        //get방식으로 데이터 수령
        function getParams() {
            //한글 깨짐 URI 수정
            var url = decodeURI(window.location.search.replace('?', ''));
            var urlArray = url.split('&');
            var params = {};
            for (var i in urlArray) {
                var param = urlArray[i].split('=');
                params[param[0]] = param[1];
            }
            if (params['searchStr'] == undefined) {
                params['searchStr'] = "";
            }
            return params;
        }
        //get 데이터 가공 후 DB에 정보 요청
        // let doc = sessionStorage.getItem("userid");


        //search text on, off
        $(function () {
            $('.searchBar').on('input', function (f) {
                if ($('.searchBar').val() != '') {
                    // 엔터키 입력시 form submit
                    // addEventListener('keydown', function (e) {
                    //     if ((e.code == 'Enter') || (e.code == 'NumpadEnter')) {
                    //          document.getElementsByClassName('searchForm').submit();
                    //     }
                    // })
                    $('.searchBarText').css("font-size", "15px");
                    $('.searchBarText').css("bottom", "50px");
                    $('.searchBarText').css("paddign-right", "300px");
                } else {
                    $('.searchBarText').attr("value", "사용자 찾기");

                    $('.searchBarText').css("font-size", "22px");
                    $('.searchBarText').css("bottom", "20px");
                    $('.searchBarText').css("paddign-right", "0");
                }

            })

        })
        //
        document.addEventListener("DOMContentLoaded", ready());
        function ready() {
            // 홈 아이콘
            $('.div_homeIcon').click(function () {
                location.href = 'index.html';
            })
            // 검색창 애니메이션
            $('.searchBar').hover(function () {
                $('.searchBarText').css("font-size", "15px");
                $('.searchBarText').css("bottom", "50px");
            }, function () {
                $('.searchBarText').css("font-size", "22px");
                $('.searchBarText').css("bottom", "20px");

            })

            $("#loginbtn").click(async function () {
                location.href = "login.html";
            });

            // index.html에서 페이지가 로드될 때 실행되는 코드

            const loggedInUser = JSON.parse(sessionStorage.getItem("loggedInUser"));
            const loginButton = document.getElementById("loginbtn");
            const logoutButton = document.getElementById("logoutbtn");
            const userNameLabel = document.getElementById("username");
            /*
          const HyunjiProfile=document.getElementById('hyunji_profile');
          const WonhaProfile=document.getElementById('wonha_profile');
          const HyunProfile=document.getElementById('hyun_profile');
          const HyeonhoProfile=document.getElementById('hyeonho_profile');
          const jaeseokProfile=document.getElementById('jaeseok_profile');*/

            if (loggedInUser) {
                // 사용자가 로그인되어 있는 경우
                loginButton.style.display = "none"; // 로그인 버튼 숨기기
                userNameLabel.innerText = `${loggedInUser.name}'s 팀원을 찾는 여정!`; // 사용자 이름 표시
                logoutButton.style.display = "inline-block"; // 로그아웃 버튼 보이기

                $("#hyunji_profile").click(async function () {
                    location.href = "contents.html";
                });
                $("#hyeonho_profile").click(async function () {
                    location.href = "contents.html";
                });
                $("#wonha_profile").click(async function () {
                    location.href = "contents.html";
                });
                $("#hyun_profile").click(async function () {
                    location.href = "contents.html";
                });
                $("#jaeseok_profile").click(async function () {
                    location.href = "contents.html";
                });
                $("#gotocontentsBtn").click(async function () {
                    location.href = "contents.html";
                });
                $("#letsgo_search1").click(async function () {
                    location.href = "searchPage.html";
                });
                $("#letsgo_search2").click(async function () {
                    location.href = "searchPage.html";
                });
                $("#letsgo_contents").click(async function () {
                    location.href = "contents.html";
                });

                // console.log("로그인된 사용자 정보 :", loggedInUser);
            } else {
                // 사용자가 로그인되어 있지 않은 경우
                loginButton.style.display = "inline-block"; // 로그인 버튼 보이기
                userNameLabel.innerText = ""; // 사용자 이름 숨기기
                logoutButton.style.display = "none"; // 로그아웃 버튼 숨기기
                $("#hyunji_profile").click(async function () {
                    location.href = "login.html";
                });
                $("#hyeonho_profile").click(async function () {
                    location.href = "login.html";
                });
                $("#wonha_profile").click(async function () {
                    location.href = "login.html";
                });
                $("#hyun_profile").click(async function () {
                    location.href = "login.html";
                });
                $("#jaeseok_profile").click(async function () {
                    location.href = "login.html";
                });
                $("#gotocontentsBtn").click(async function () {
                    location.href = "login.html";
                });
                $("#letsgo_search1").click(async function () {
                    location.href = "login.html";
                });
                $("#letsgo_search2").click(async function () {
                    location.href = "login.html";
                });
                $("#letsgo_contents").click(async function () {
                    location.href = "login.html";
                });
            }


            // 로그아웃 버튼 클릭 시 세션 초기화 및 리다이렉트
            $("#logoutbtn").click(async function () {
                sessionStorage.removeItem("loggedInUser");
                //window.location.href = 'login.html';
                window.location.reload();
            });



            // ~~ready()
        };
        // 일정 주기로 그라데이션 변경
        $('.profileSearchFooterGradient2').css("transition", "all 3s ease-in-out");
        $('.profileSearchLine2').css("transition", "all 2s ease-in-out");
        let profileSearchFooterGradient2 = 0;
        setInterval(function () {
            if (profileSearchFooterGradient2 == 0) {
                $('.profileSearchFooterGradient2').css("opacity", "0");
                profileSearchFooterGradient2 = 1;
                $('.profileSearchLine2').css("opacity", "0");
            } else {
                $('.profileSearchFooterGradient2').css("opacity", "1");
                profileSearchFooterGradient2 = 0;
                $('.profileSearchLine2').css("opacity", "1");
            }
        }, 3000);


    </script>
</body>

</html>